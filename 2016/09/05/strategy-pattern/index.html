<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="分享Android开发经验，Android开发技巧，Android Studio使用总结"><title>【设计模式】策略模式 | 凯子哥的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/4.1.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.6.2/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/2.2.3/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">【设计模式】策略模式</h1><a id="logo" href="/.">凯子哥的博客</a><p class="description">专注Android开发与技术分享，关注产品、营销与用户体验</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">【设计模式】策略模式</h1><div class="post-meta">Sep 5, 2016<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><a data-disqus-identifier="2016/09/05/strategy-pattern/" href="/2016/09/05/strategy-pattern/#disqus_thread" class="disqus-comment-count"></a><div class="clear"><div id="toc" class="toc-article"><div class="toc-title">文章目录</div></div></div><div class="post-content"><p>凯子哥到新公司入职的第一天，就被老板交到了办公室。</p>
<p>老板说：“凯子啊，听说你最近在研究设计模式呀，有什么收获吗？”</p>
<p>凯子说：“刚把《Head First设计模式》看了一遍，之前还看过《Android设计模式解析与实战》，多多少少知道一些。”</p>
<p>老板说：“挺好学的呀，这两本书都挺不错的，既然都看过了，今天给你一个新需求，你帮我实现下吧！”</p>
<p>凯子高兴的说：“好啊，正好可以练练手！能把需求具体说下吗？”</p>
<a id="more"></a>
<p>老板说：“需求很简单，我们在做一个离线版的内容阅读软件，所有的数据都存储在本地数据库，你需要帮我写一个获取《每日一篇》数据的工具类，咱们一共有三个频道，分别是《糗事百科》、《煎蛋》和《夫妻夜话》，每个频道都有一个名称ChannelName和一个内部的数据库代号DataSource来区分来源，通过DataSource和当天的日期可以在数据库查询到唯一的一条数据DailyData，用户可以通过切换这三个频道来选择阅读其中某个频道的内容。好啦，就是这么多，你去做吧！”</p>
<p>凯子说：“得令！小的这就去写代码！”</p>
<p>回到工位上，凯子心想，这还不简单？根本不用想，上手就来！</p>
<p>凯子哥首先整理了下需求，大约需要以下几个接口：</p>
<ol>
<li><p>获取所有的频道名称，用于给用户展示所有的频道</p>
</li>
<li><p>根据用户点击的频道名称，获取对应的DataSource，用于获取数据(其实这个设计并不好，通过DataSource将所有的数据绑起来，缺乏灵活性，如果直接以ChannelName来作为来源区分，代码上会简单很多。这里就不过多追究了)</p>
</li>
<li><p>根据当天的日期和选中频道的DataSource就可以去数据库类DailyDateDB中取得对应的数据</p>
</li>
</ol>
<p>需求确定了，剩下的就是编码了！</p>
<p>于是凯子哥编写了一个工具类DailyDataUtil来解决这一切。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DailyDataUtil &#123;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_ILLEGAL = -1;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_QIUBAI = 1; </span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_IANDAN = 2; </span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_FUQIYEHUA = 3;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_QIUBAI = &quot;糗事百科&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_JIANDAN = &quot;煎蛋&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_FUQIYEHUA = &quot;夫妻夜话&quot;;</span><br><span class="line"></span><br><span class="line">    public static DailyData getDailyDate(String date, int dataSource) &#123;</span><br><span class="line"></span><br><span class="line">             return DailyDateDB.getDailyDate(date, dataSource); </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     public static List&lt;String&gt; getAllChannelName() &#123; </span><br><span class="line"></span><br><span class="line">            return Arrays.asList(CHANNEL_QIUBAI, CHANNEL_JIANDAN, CHANNEL_FUQIYEHUA); </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     public static int getDataSource(String channelName) &#123; </span><br><span class="line"></span><br><span class="line">        if (CHANNEL_QIUBAI.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_QIUBAI;</span><br><span class="line"></span><br><span class="line">            &#125; else if (CHANNEL_JIANDAN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_IANDAN;</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_FUQIYEHUA;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>做完之后，凯子就让老板review了下，老板看了下说：“可以，先这样做吧，没什么大问题。”</p>
<p>于是凯子就高高兴兴的把这个类Check In了。</p>
<p>一个月以后，老板又把凯子叫到了办公室，高兴地对凯子说：“你还记得之前做的那个阅读类App吗？现在用户很喜欢，日活已经过百万了！这个月就给你发奖金！我们现在不光要面向国内市场，我们要走出中国，走向世界，再加一个英语的数据工具类吧，如果在英文手机上，就只显示英文内容，在中文手机上，就只显示中文的内容，希望你能快速的给出一个方案！我们的千万日活和财富自由就靠你了，凯子！”</p>
<p>凯子回到工位上，思考了一会，不就是加个英文内容吗，简单，加个if语句就得了。而且要自动的根据本地的语言切换数据源，这个也简单，只需要判断一下本地的语言就可以了。</p>
<p>说改就改，下面是修改之后的版本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DailyDataUtil &#123;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_ILLEGAL = -1;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_QIUBAI = 1;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_IANDAN = 2;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_FUQIYEHUA = 3;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_QIUBAI = &quot;糗事百科&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_JIANDAN = &quot;煎蛋&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_FUQIYEHUA = &quot;夫妻夜话&quot;;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_QIUBAI_EN = 4;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_IANDAN_EN = 5;</span><br><span class="line"></span><br><span class="line">    private static final int DATA_SOURCE_FUQIYEHUA_EN = 6;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_QIUBAI_EN = &quot;QiuShiBaiKe&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_JIANDAN_EN = &quot;JianDan&quot;;</span><br><span class="line"></span><br><span class="line">    private static final String CHANNEL_FUQIYEHUA_EN = &quot;FuQiYeHua&quot;;</span><br><span class="line"></span><br><span class="line">    public static DailyData getDailyDate(String date, int dataSource) &#123;</span><br><span class="line"></span><br><span class="line">        return DailyDateDB.getDailyDate(date, dataSource);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;String&gt; getAllChannelName(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        if (isEnLanguage(context)) &#123;</span><br><span class="line"></span><br><span class="line">            return Arrays.asList(CHANNEL_QIUBAI_EN, CHANNEL_JIANDAN_EN, CHANNEL_FUQIYEHUA_EN);</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            return Arrays.asList(CHANNEL_QIUBAI, CHANNEL_JIANDAN, CHANNEL_FUQIYEHUA);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static int getDataSource(Context context, String channelName) &#123;</span><br><span class="line"></span><br><span class="line">        if (TextUtils.isEmpty(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_ILLEGAL;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        if (isEnLanguage(context)) &#123;</span><br><span class="line"></span><br><span class="line">            if (CHANNEL_QIUBAI_EN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_QIUBAI_EN;</span><br><span class="line"></span><br><span class="line">            &#125; else if (CHANNEL_JIANDAN_EN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_IANDAN_EN;</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_FUQIYEHUA_EN;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            if (CHANNEL_QIUBAI.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_QIUBAI;</span><br><span class="line"></span><br><span class="line">            &#125; else if (CHANNEL_JIANDAN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_IANDAN;</span><br><span class="line"></span><br><span class="line">            &#125; else &#123;</span><br><span class="line"></span><br><span class="line">                return DATA_SOURCE_FUQIYEHUA;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static boolean isEnLanguage(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        return context.getResources().getConfiguration().locale.getLanguage().equalsIgnoreCase(&quot;en&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>从上面的代码可以看出，为了判断本地的语言环境，我们传入了一个Context对象，这使得我们修改了方法参数，那么我们就必须修改所有调用这个方法的地方，这是非常危险的，因为其他经过测试的代码有可能会带入BUG。其实我们也可以在Application初始化的时候就取得当前的语言环境，然后通过静态方法对外部暴露，这里我们就不再赘述。</p>
<p>除此之外，为了增加一个英文版本的内容，我们可以发现，除了getDailyDate()外，其他方法也都改动了，这也会增加已有代码的风险，而且增加的很多if判断，使得整个代码的可读性变差。</p>
<p>“算了，算了，先发布再说吧！老板着急要呢！”于是凯子就把代码Check In了，新版本顺利发布，凯子回家睡了一个好觉。</p>
<p>又过了一个月，早上一进门，老板就兴奋的指着GA后台的用户增长曲线对凯子说：“凯子，你看！咱们的日活已经过200W了！看来这个App很有潜力呀！(废话，2个月就到200W的日活，傻子也能看出来)咱们要做一款国际化的大App了！我决定咱们暂时增加西班牙语、葡语、印度语、日语、韩语的内容！你快去做吧！今天晚上咱们就上线！”</p>
<p>回到工位后，一想到以后还有可能适配全球N种语言，凯子坐在座位上傻掉了。</p>
<p>一个小时以后(有可能思考的时候睡着了)，凯子眼前一亮，嘴中不断的呢喃着：”策略！策略！策略模式啊！“</p>
<p>那么，什么是策略模式呢？</p>
<p>##策略模式的定义</p>
<p>策略模式定义了算法族，分别封装起来，让它们之间可以相互替换，此模式让算法的替换独立于算法的客户。</p>
<p>我知道这样死板的定义你不想看，那么我们就一起思考下，在这个场景下，可以使用策略模式吗？</p>
<p>我认为，掌握策略模式最重要的就是要理解以下两点：</p>
<ol>
<li><p>算法族</p>
</li>
<li><p>替换</p>
</li>
</ol>
<p>什么是算法族？</p>
<p>首先不要被这个“算法”所迷惑，不要认为只有在涉及到比较复杂的运算的时候才使用到算法，其实这里的算法随处可见，比如说上面提到的这个简单的获取每日数据的类，是不是算法呢？我认为是算的，只要涉及到逻辑的地方都有算法的存在，只不过有的简单，有的复杂罢了。</p>
<p>那么怎么理解“族”呢？“族”就指的不是一个，就是一群，而且一定是一群具有相似的属性的事物才能是一个族，比如“汉族”。除此之外，有“族”就存在多态，就像“我是一个汉族人”，“归并排序算法是一种排序算法”，理解了这一点，就很容易理解策略模式了。</p>
<p>那么怎么理解替换呢？既然存在多态了，如果我要一个排序算法，你给我一个归并排序算法，可不可以呢？当然可以。那我想要其他类型的排序算法可以吗？当然也可以。多态的威力就在于此，随便你怎么替换，只要能满足我的需求就ok。那么怎么替换呢？一个简单的setter就解决了。</p>
<p>##改造代码</p>
<p>已经简单的了解了下什么是策略模式，那么我们怎么改造一下上面的代码呢？</p>
<p>首先我们要找出可以替换的算法族。怎么找呢？其实有一个窍门，那就是如果有很多if语句，就说明这里可以分解成很多的策略，在这里就是这两个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public static List&lt;String&gt; getAllChannelName(Context context)</span><br><span class="line"></span><br><span class="line">public static int getDataSource(Context context, String channelName)</span><br></pre></td></tr></table></figure>
<p>既然算法族可以替换，我们就应该提取基类，然后在子类中实现不同的算法，比如我们这里定义基类为抽象类DailyDataCapturer，它包含了上面两个可以替换的算法，以及一些常量类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public abstract class DailyDataCapturer &#123; ...公共常量... protected abstract List&lt;String&gt; getAllChannelName(); protected abstract int getDataSource(String channelName);&#125;</span><br></pre></td></tr></table></figure>
<p>子类为CNCapturer和ENCapturer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class CNCapturer extends DailyDataCapturer &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line"></span><br><span class="line">    public List&lt;String&gt; getAllChannelName() &#123;</span><br><span class="line"></span><br><span class="line">        return Arrays.asList(CHANNEL_QIUBAI, CHANNEL_JIANDAN, CHANNEL_FUQIYEHUA);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line"></span><br><span class="line">    public int getDataSource(String channelName) &#123;</span><br><span class="line"></span><br><span class="line">        if (CHANNEL_QIUBAI.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_QIUBAI;</span><br><span class="line"></span><br><span class="line">        &#125; else if (CHANNEL_JIANDAN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_IANDAN;</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_FUQIYEHUA;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class ENCapturer extends DailyDataCapturer &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line"></span><br><span class="line">    protected List&lt;String&gt; getAllChannelName() &#123;</span><br><span class="line"></span><br><span class="line">        return Arrays.asList(CHANNEL_QIUBAI_EN, CHANNEL_JIANDAN_EN, CHANNEL_FUQIYEHUA_EN);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line"></span><br><span class="line">    protected int getDataSource(String channelName) &#123;</span><br><span class="line"></span><br><span class="line">        if (CHANNEL_QIUBAI_EN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_QIUBAI_EN;</span><br><span class="line"></span><br><span class="line">        &#125; else if (CHANNEL_JIANDAN_EN.equalsIgnoreCase(channelName)) &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_IANDAN_EN;</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            return DATA_SOURCE_FUQIYEHUA_EN;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了不同的算法族，剩下的就是提供可以更换的算法接口了，我们对外提供一个公共的方法类DailyDataUtil来完成相关工作：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class DailyDataUtil &#123;</span><br><span class="line"></span><br><span class="line">    private static DailyDataCapturer sCapturer;</span><br><span class="line"></span><br><span class="line">    public static void init(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        if (isEnLanguage(context)) &#123;</span><br><span class="line"></span><br><span class="line">            sCapturer = new ENCapturer();</span><br><span class="line"></span><br><span class="line">        &#125; else &#123;</span><br><span class="line"></span><br><span class="line">            sCapturer = new CNCapturer();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static List&lt;String&gt; getAllChannelName() &#123;</span><br><span class="line"></span><br><span class="line">        return sCapturer.getAllChannelName();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static int getDataSource(String channelName) &#123;</span><br><span class="line"></span><br><span class="line">        return sCapturer.getDataSource(channelName);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private static boolean isEnLanguage(Context context) &#123;</span><br><span class="line"></span><br><span class="line">        return context.getResources().getConfiguration().locale.getLanguage().equalsIgnoreCase(&quot;en&quot;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们只需要在init()中完成子类的选择，后面的所有方法就可以直接对接到合适的算法，减少了if语句的使用，使得逻辑更加的清晰。</p>
<p>如果我们想要添加一种语言的支持，现在还很困难吗？如果是以前的结构，我们需要修改所有涉及到语言的函数，复制粘贴，然后修改成对应语言的逻辑，这样就破坏了函数的封装性，还记得那句话吗？”对修改关闭，对扩展开放“，用if语句的方式来实现不同的策略，每次增删都需要修改原有代码，很容易引入BUG，同时也使得测试的压力变大，因为之前的逻辑都被修改了。</p>
<p>但是如果采用现在的策略模式，我们每增加一种语言的支持，我们只需要添加一个子类，然后在init()中添加子类的初始化逻辑即可，其他的任何代码不需要改动，这无疑大大提高了代码的可靠性，以前的代码不需要在进行重新测试，所以是对”对修改关闭，对扩展开放“。</p>
<p>##优缺点总结</p>
<p>从上面的情境中，我们可以总结出使用策略模式的优缺点。</p>
<p>优点就是：</p>
<ol>
<li><p>利用继承来将需要实现的具体方法放在基类中，添加新的策略子类时，只需要继承然后完成具体实现即可</p>
</li>
<li><p>可以动态的替换所要使用的策略，这是利用多态实现的</p>
</li>
<li><p>可以减少if语句，使得代码可读性更好</p>
</li>
</ol>
<p>缺点也是有的：</p>
<ol>
<li><p>因为策略类可以无限多，所以客户必须清楚自己想用哪一个策略类来完成需求</p>
</li>
<li><p>每添加一种策略就必须添加一个类，可能会使得策略类比较多</p>
</li>
</ol>
<p>相对于策略类带来的优势而言，这些缺点相对而言还是可以接受的，如果你的业务逻辑适合使用策略模式，那就尽情的使用吧！</p>
<p>##应用举例</p>
<p>在Android中策略模式最常见的应用是各种View的Adapter实现，比如ListView和RecyclerView的Adapter实现，虽然Adapter是一种很明显的适配器模式，但是想想我们在使用Adapter的过程中是否有策略模式的影子？</p>
<p>以RecyclerView为例，首先我们必须继承RecyclerView.Adapter，然后实现下面三个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public RecordHolder onCreateViewHolder(ViewGroup parent, int viewType) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public void onBindViewHolder(RecordHolder holder, int position) &#123;&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line"></span><br><span class="line">public int getItemCount() &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>这就相当于是算法族里面的可替换算法，到底返回多少个item，生成什么样的界面，都是我们的子类控制的。想想一下，假如我们有一个商品详情界面，在不同分辨率的手机上的显示元素不同，那么我们只需要在界面初始化的时候根据分辨率动态的初始化不同分辨率的的Adapter子类就可以了，这就是不同的策略，也当然是一种策略模式。</p>
<p>除此之外，实现动画效果时的插值器也是应用了策略模式，OkHttp框架中也能看到策略模式的身影，比如下面这个方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">public class OkHttpClient implements Cloneable &#123;</span><br><span class="line"></span><br><span class="line">    public OkHttpClient setAuthenticator(Authenticator authenticator) &#123;       </span><br><span class="line"></span><br><span class="line">        this.authenticator = authenticator;     </span><br><span class="line"></span><br><span class="line">        return this;    </span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public interface Authenticator &#123;  </span><br><span class="line"></span><br><span class="line">    Request authenticate(Proxy proxy, Response response) throws IOException; </span><br><span class="line"></span><br><span class="line">    Request authenticateProxy(Proxy proxy, Response response) throws IOException;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a rel="external" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/" target="_blank"><br><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/3.0/cn/88x31.png"><br></a><br><br>本作品采用<a rel="external" href="http://creativecommons.org/licenses/by-nc-nd/3.0/cn/" target="_blank">知识共享署名-非商业性使用-禁止演绎 3.0 中国大陆许可协议</a>进行许可。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://kaizige.vip/2016/09/05/strategy-pattern/" data-id="cisq113fv0005v8s62lgf4myh" class="article-share-link">分享到</a><div class="tags"><a href="/tags/Android/">Android</a></div><div class="post-nav"><a href="/2016/06/26/how-to-save-blog-image/" class="next">如何解决Markdown本地图片的保存问题？</a></div><div id="disqus_thread"><script>var disqus_shortname = 'kaizige';
var disqus_identifier = '2016/09/05/strategy-pattern/';
var disqus_title = '【设计模式】策略模式';
var disqus_url = 'http://kaizige.vip/2016/09/05/strategy-pattern/';
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//kaizige.disqus.com/count.js" async></script></div></div></div></div><div class="pure-u-1-4"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://kaizige.vip"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/其他/">其他</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/Blog/" style="font-size: 15px;">Blog</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/KLog/" style="font-size: 15px;">KLog</a> <a href="/tags/Log/" style="font-size: 15px;">Log</a> <a href="/tags/Util/" style="font-size: 15px;">Util</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/09/05/strategy-pattern/">【设计模式】策略模式</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/26/how-to-save-blog-image/">如何解决Markdown本地图片的保存问题？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/13/klog/">Android专用Log打印工具KLog使用指南</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/06/10/how-to-build-up-yourself-hexo-blog/">使用Hexo搭建免费的个人技术博客</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o"> 最近评论</i></div><script type="text/javascript" src="//kaizige.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://blog.csdn.net/zhaokaiqiang1992" title="CSDN凯子哥" target="_blank">CSDN凯子哥</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">凯子哥的博客.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?d080b2d258d701efddb4269834cbb983";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
  })();
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>